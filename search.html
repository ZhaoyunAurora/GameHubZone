<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-WPXE8P54YR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-WPXE8P54YR');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Results - GameHubZone</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4F46E5',
                        secondary: '#10B981',
                        accent: '#F59E0B',
                        dark: '#1F2937',
                        light: '#F3F4F6'
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .game-card {
                @apply bg-white rounded-lg shadow-md overflow-hidden transition-transform duration-300 hover:shadow-xl hover:-translate-y-1;
            }
            .game-stats {
                @apply flex items-center text-sm text-gray-600;
            }
            .nav-link {
                @apply px-5 py-2.5 rounded-full font-medium text-gray-600 border border-transparent transition-all duration-200 whitespace-nowrap hover:text-primary hover:border-gray-200 hover:bg-white hover:shadow-sm;
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- 导航栏 -->
    <header id="navbar" class="bg-white shadow-sm fixed w-full top-0 z-50 transition-transform duration-300">
        <div class="container mx-auto px-4 sm:px-6 md:px-8 lg:px-12 xl:px-16 py-3">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-2">
                    <a href="index.html" class="flex items-center space-x-2">
                        <div class="w-10 h-10 bg-primary rounded-lg flex items-center justify-center text-white font-bold text-xl">G</div>
                        <span class="text-xl font-bold text-dark">GameHubZone</span>
                    </a>
                </div>
                
                <!-- 搜索框 -->
                <div class="hidden md:block ml-6 w-64">
                    <form id="search-form" action="search.html" method="get">
                        <div class="relative">
                            <input type="text" name="q" id="search-input" placeholder="Search games..." required
                                class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                            <button type="submit" class="absolute right-2 top-1/2 -translate-y-1/2 bg-primary text-white p-1.5 rounded-md">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </header>

    <!-- 添加占位符，防止内容被固定导航栏遮挡 -->
    <div class="h-16"></div>

    <main class="container mx-auto px-4 sm:px-6 md:px-8 lg:px-12 xl:px-16 py-8">
        <!-- 搜索结果部分 -->
        <section class="mt-8 mb-12">
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center">
                    <div class="w-8 h-8 bg-primary bg-opacity-10 rounded-full flex items-center justify-center mr-2">
                        <i class="fas fa-search text-primary"></i>
                    </div>
                    <h1 class="text-2xl font-bold text-dark">Search Results: <span id="search-query" class="text-primary"></span></h1>
                </div>
                <a href="index.html" class="text-primary hover:underline flex items-center">
                    <i class="fas fa-arrow-left mr-1"></i> Back to Home
                </a>
            </div>

            <!-- 搜索结果状态 -->
            <div id="search-status" class="mb-6 text-gray-600">
                <!-- 这里会显示搜索结果的状态信息 -->
            </div>

            <!-- 搜索结果网格 -->
            <div id="search-results" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                <!-- 搜索结果将通过JavaScript动态生成 -->
                <div class="loading-spinner flex justify-center items-center py-16 col-span-full">
                    <i class="fas fa-spinner fa-spin text-3xl text-primary"></i>
                </div>
            </div>

            <!-- 无结果提示 -->
            <div id="no-results" class="text-center py-16 hidden">
                <div class="w-24 h-24 mx-auto mb-6 bg-gray-100 rounded-full flex items-center justify-center">
                    <i class="fas fa-search text-4xl text-gray-400"></i>
                </div>
                <h3 class="text-xl font-medium text-gray-700 mb-2">No games found</h3>
                <p class="text-gray-500 mb-6">Try different keywords or browse all games</p>
                <a href="index.html" class="bg-primary text-white px-6 py-3 rounded-lg inline-block hover:bg-primary-dark transition-colors">
                    Browse All Games
                </a>
            </div>
        </section>
    </main>

    <!-- 页脚 -->
    <footer class="bg-dark text-white">
        <div class="container mx-auto px-4 sm:px-6 md:px-8 lg:px-12 xl:px-16 py-8">
            <div class="max-w-5xl mx-auto flex flex-col md:flex-row justify-between items-center">
                <div class="flex items-center space-x-2 mb-6 md:mb-0">
                    <div class="w-10 h-10 bg-primary rounded-lg flex items-center justify-center text-white">
                        <span class="font-bold text-xl">G</span>
                    </div>
                    <span class="text-xl font-bold">GameHubZone</span>
                </div>
                
                <div class="flex flex-col items-center md:items-end">
                    <div class="flex flex-wrap justify-center md:justify-end space-x-6 mb-4">
                        <a href="#" class="hover:text-white transition-colors">Privacy Policy</a>
                        <a href="#" class="hover:text-white transition-colors">Terms of Use</a>
                        <a href="#" class="hover:text-white transition-colors">Cookie Policy</a>
                    </div>
                    
                    <p class="text-center md:text-right text-gray-400 text-sm">© 2023 GameHubZone Technologies Pvt. Ltd. All rights reserved.</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- 搜索处理脚本 -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 获取搜索参数
            const urlParams = new URLSearchParams(window.location.search);
            const searchQuery = urlParams.get('q');
            
            // 如果没有搜索词，返回首页
            if (!searchQuery) {
                window.location.href = 'index.html';
                return;
            }
            
            // 显示搜索词
            document.getElementById('search-query').textContent = searchQuery;
            document.getElementById('search-input').value = searchQuery;
            
            // 获取必要的DOM元素
            const searchResults = document.getElementById('search-results');
            const searchStatus = document.getElementById('search-status');
            const noResults = document.getElementById('no-results');
            
            // 加载游戏数据
            fetch('data/games.csv')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP错误 ${response.status}`);
                    }
                    return response.text();
                })
                .then(csvData => {
                    console.log('CSV数据加载成功，长度:', csvData.length);
                    
                    // 解析CSV数据
                    const games = parseCSV(csvData);
                    console.log('解析的游戏数据:', games.length);
                    
                    // 执行搜索
                    const results = searchGames(games, searchQuery);
                    console.log('搜索结果数量:', results.length);
                    
                    // 显示结果
                    displaySearchResults(results, searchQuery);
                })
                .catch(error => {
                    console.error('加载游戏数据时出错:', error);
                    searchResults.innerHTML = `<div class="col-span-full text-center py-8">
                        <p class="text-red-500 mb-2">Error loading games: ${error.message}</p>
                        <p>Please check if the data file exists and try again.</p>
                    </div>`;
                });
            
            // 解析CSV数据函数
            function parseCSV(csvData) {
                const rows = csvData.split('\n');
                const headers = rows[0].split(',');
                const games = [];
                
                for (let i = 1; i < rows.length; i++) {
                    // 跳过空行
                    if (!rows[i].trim()) continue;
                    
                    // 分割当前行
                    const values = rows[i].split(',');
                    
                    // 创建游戏对象
                    const game = {};
                    
                    // 遍历每个字段，将值赋给相应的属性
                    for (let j = 0; j < headers.length; j++) {
                        if (j < values.length) {
                            game[headers[j].trim()] = values[j].trim();
                        } else {
                            game[headers[j].trim()] = '';
                        }
                    }
                    
                    // 合并Sports为Sports & Racing（保持与index.html一致）
                    if (game.category === 'Sports') {
                        game.category = 'Sports & Racing';
                    }
                    
                    // 添加到游戏集合
                    games.push(game);
                }
                
                return games;
            }
            
            // 搜索游戏函数 - 增强搜索能力
            function searchGames(games, query) {
                query = query.toLowerCase();
                
                return games.filter(game => {
                    // 在游戏名称中搜索（权重最高）
                    if (game.name && game.name.toLowerCase().includes(query)) return true;
                    
                    // 在游戏描述中搜索
                    if (game.description && game.description.toLowerCase().includes(query)) return true;
                    
                    // 在游戏类别中搜索
                    if (game.category && game.category.toLowerCase().includes(query)) return true;
                    
                    // 在标签中搜索（如果存在）
                    if (game.tags && game.tags.toLowerCase().includes(query)) return true;
                    
                    return false;
                });
            }
            
            // 显示搜索结果函数
            function displaySearchResults(results, query) {
                // 移除加载动画
                searchResults.innerHTML = '';
                
                // 更新状态信息
                if (results.length === 0) {
                    searchStatus.textContent = `No games found for "${query}"`;
                    noResults.classList.remove('hidden');
                    return;
                } else {
                    searchStatus.textContent = `Found ${results.length} game${results.length === 1 ? '' : 's'} for "${query}"`;
                }
                
                // 显示搜索结果
                results.forEach(game => {
                    const gameCard = document.createElement('div');
                    gameCard.className = 'game-card';
                    
                    gameCard.innerHTML = `
                        <a href="games/${game.id}.html">
                            <div class="relative">
                                <img src="${game.thumbnail}" alt="${game.name}" class="w-full h-44 object-cover">
                                ${game.isNew === 'TRUE' ? '<span class="absolute top-2 left-2 bg-blue-100 text-blue-800 text-xs font-semibold px-2 py-1 rounded">NEW</span>' : ''}
                            </div>
                            <div class="p-4">
                                <h3 class="font-semibold text-lg mb-1">${game.name}</h3>
                                <div class="flex justify-between">
                                    <span class="game-stats">
                                        <i class="far fa-clock mr-1"></i> ${game.playtime || 'N/A'}
                                    </span>
                                    <span class="game-stats">
                                        <i class="far fa-user mr-1"></i> ${game.plays || '0'}
                                    </span>
                                </div>
                            </div>
                        </a>
                    `;
                    
                    searchResults.appendChild(gameCard);
                });
            }

            // 在搜索提交时保存历史
            function saveSearchHistory(query) {
                let history = JSON.parse(localStorage.getItem('searchHistory') || '[]');
                if (!history.includes(query)) {
                    history.unshift(query);
                    // 保留最近10次搜索
                    if (history.length > 10) history.pop();
                    localStorage.setItem('searchHistory', JSON.stringify(history));
                }
            }
        });
        
        // 导航栏滚动逻辑
        let lastScrollTop = 0;
        const navbar = document.getElementById('navbar');
        const navbarHeight = navbar.offsetHeight;
        
        window.addEventListener('scroll', function() {
            let scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            
            if (scrollTop > lastScrollTop && scrollTop > navbarHeight) {
                navbar.style.transform = 'translateY(-100%)';
            } else {
                navbar.style.transform = 'translateY(0)';
            }
            
            lastScrollTop = scrollTop;
        });
    </script>
</body>
</html>
